{"ast":null,"code":"var _jsxFileName = \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/src/components/widgets/CustomCategoryWidget.js\";\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { addFilter, removeFilter } from '@carto/react-redux';\nimport { WrapperWidgetUI, CategoryWidgetUI, NoDataAlert } from '@carto/react-ui';\nimport { _FilterTypes as FilterTypes, AggregationTypes } from '@carto/react-core';\nimport { getCategories } from '@carto/react-widgets';\nimport { useSourceFilters } from '@carto/react-widgets';\nimport { selectAreFeaturesReadyForSource } from '@carto/react-redux/';\nimport { useWidgetFilterValues } from './useWidgetFilterValues';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EMPTY_ARRAY = [];\n/**\n * Renders a <CustomCategoryWidget /> component\n * @param  {object} props\n * @param  {string} props.id - ID for the widget instance.\n * @param  {string} props.title - Title to show in the widget header.\n * @param  {string} props.dataSource - ID of the data source to get the data from.\n * @param  {string} props.column - Name of the data source's column to get the data from.\n * @param  {string} [props.operationColumn] - Name of the data source's column to operate with. If not defined it will default to the one defined in `column`.\n * @param  {string} props.operation - Operation to apply to the operationColumn. Must be one of those defined in `AggregationTypes` object.\n * @param  {Function} [props.formatter] - Function to format each value returned.\n * @param  {Object} [props.labels] - Overwrite category labels.\n * @param  {boolean} [props.animation] - Enable/disable widget animations on data updates. Enabled by default.\n * @param  {boolean} [props.filterable] - Enable/disable widget filtering capabilities. Enabled by default.\n * @param  {boolean} [props.searchable] - Enable/disable widget searching capabilities. Enabled by default.\n * @param  {Function} [props.onError] - Function to handle error messages from the widget.\n * @param  {Object} [props.wrapperProps] - Extra props to pass to [WrapperWidgetUI](https://storybook-react.carto.com/?path=/docs/widgets-wrapperwidgetui--default)\n * @param  {Object} [props.noDataAlertProps] - Extra props to pass to [NoDataAlert]()\n * @param {Array} [props.otherSources] - Extra sources to filter based on the main source.\n */\n\nfunction CustomCategoryWidget(props) {\n  const {\n    id,\n    title,\n    dataSource,\n    column,\n    operationColumn,\n    operation,\n    formatter,\n    labels,\n    animation,\n    filterable,\n    searchable,\n    onError,\n    wrapperProps,\n    noDataAlertProps,\n    otherSources\n  } = props;\n  const dispatch = useDispatch();\n  const isSourceReady = useSelector(state => {\n    const isReady = selectAreFeaturesReadyForSource(state, dataSource);\n    console.log(otherSources);\n    return selectAreFeaturesReadyForSource(state, dataSource);\n  });\n  const [categoryData, setCategoryData] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const filters = useSourceFilters({\n    dataSource,\n    id\n  });\n  const selectedCategories = useWidgetFilterValues({\n    dataSource,\n    id,\n    column,\n    type: FilterTypes.IN\n  }) || EMPTY_ARRAY;\n  useEffect(() => {\n    setIsLoading(true);\n\n    if (isSourceReady) {\n      getCategories({\n        column,\n        operationColumn,\n        operation,\n        filters,\n        dataSource\n      }).then(data => {\n        if (data) {\n          setIsLoading(false);\n          setCategoryData(data);\n        }\n      }).catch(error => {\n        setIsLoading(false);\n        if (onError) onError(error);\n      });\n    }\n  }, [id, column, operationColumn, operation, filters, dataSource, setIsLoading, onError, isSourceReady]);\n  const handleSelectedCategoriesChange = useCallback(categories => {\n    if (categories && categories.length) {\n      dispatch(addFilter({\n        id: dataSource,\n        column,\n        type: FilterTypes.IN,\n        values: categories,\n        owner: id\n      }));\n      otherSources.forEach(e => {\n        dispatch(addFilter({\n          id: e.id,\n          column: e.column,\n          type: FilterTypes.IN,\n          values: categories,\n          owner: id\n        }));\n      });\n    } else {\n      dispatch(removeFilter({\n        id: dataSource,\n        column\n      }));\n      otherSources.forEach(e => {\n        dispatch(removeFilter({\n          id: e.id,\n          column: e.column\n        }));\n      });\n    }\n  }, [column, dataSource, id, dispatch]);\n  return /*#__PURE__*/_jsxDEV(WrapperWidgetUI, {\n    title: title,\n    isLoading: isLoading,\n    ...wrapperProps,\n    children: categoryData.length || isLoading ? /*#__PURE__*/_jsxDEV(CategoryWidgetUI, {\n      data: categoryData,\n      formatter: formatter,\n      labels: labels,\n      selectedCategories: selectedCategories,\n      onSelectedCategoriesChange: handleSelectedCategoriesChange,\n      animation: animation,\n      filterable: filterable,\n      searchable: searchable\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(NoDataAlert, { ...noDataAlertProps\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 147,\n    columnNumber: 5\n  }, this);\n}\n\nCustomCategoryWidget.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  dataSource: PropTypes.string.isRequired,\n  column: PropTypes.string.isRequired,\n  operationColumn: PropTypes.string,\n  operation: PropTypes.oneOf(Object.values(AggregationTypes)).isRequired,\n  formatter: PropTypes.func,\n  labels: PropTypes.object,\n  animation: PropTypes.bool,\n  filterable: PropTypes.bool,\n  searchable: PropTypes.bool,\n  onError: PropTypes.func,\n  wrapperProps: PropTypes.object,\n  noDataAlertProps: PropTypes.object\n};\nCustomCategoryWidget.defaultProps = {\n  labels: {},\n  animation: true,\n  filterable: true,\n  searchable: true,\n  wrapperProps: {},\n  noDataAlertProps: {}\n};\nexport default CustomCategoryWidget;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useSelector","useDispatch","PropTypes","addFilter","removeFilter","WrapperWidgetUI","CategoryWidgetUI","NoDataAlert","_FilterTypes","FilterTypes","AggregationTypes","getCategories","useSourceFilters","selectAreFeaturesReadyForSource","useWidgetFilterValues","EMPTY_ARRAY","CustomCategoryWidget","props","id","title","dataSource","column","operationColumn","operation","formatter","labels","animation","filterable","searchable","onError","wrapperProps","noDataAlertProps","otherSources","dispatch","isSourceReady","state","isReady","console","log","categoryData","setCategoryData","isLoading","setIsLoading","filters","selectedCategories","type","IN","then","data","catch","error","handleSelectedCategoriesChange","categories","length","values","owner","forEach","e","propTypes","string","isRequired","oneOf","Object","func","object","bool","defaultProps"],"sources":["/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/src/components/widgets/CustomCategoryWidget.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { addFilter, removeFilter } from '@carto/react-redux';\nimport { WrapperWidgetUI, CategoryWidgetUI, NoDataAlert } from '@carto/react-ui';\nimport { _FilterTypes as FilterTypes, AggregationTypes } from '@carto/react-core';\nimport { getCategories } from '@carto/react-widgets';\nimport { useSourceFilters } from '@carto/react-widgets';\nimport { selectAreFeaturesReadyForSource } from '@carto/react-redux/';\nimport { useWidgetFilterValues } from './useWidgetFilterValues';\n\nconst EMPTY_ARRAY = [];\n\n/**\n * Renders a <CustomCategoryWidget /> component\n * @param  {object} props\n * @param  {string} props.id - ID for the widget instance.\n * @param  {string} props.title - Title to show in the widget header.\n * @param  {string} props.dataSource - ID of the data source to get the data from.\n * @param  {string} props.column - Name of the data source's column to get the data from.\n * @param  {string} [props.operationColumn] - Name of the data source's column to operate with. If not defined it will default to the one defined in `column`.\n * @param  {string} props.operation - Operation to apply to the operationColumn. Must be one of those defined in `AggregationTypes` object.\n * @param  {Function} [props.formatter] - Function to format each value returned.\n * @param  {Object} [props.labels] - Overwrite category labels.\n * @param  {boolean} [props.animation] - Enable/disable widget animations on data updates. Enabled by default.\n * @param  {boolean} [props.filterable] - Enable/disable widget filtering capabilities. Enabled by default.\n * @param  {boolean} [props.searchable] - Enable/disable widget searching capabilities. Enabled by default.\n * @param  {Function} [props.onError] - Function to handle error messages from the widget.\n * @param  {Object} [props.wrapperProps] - Extra props to pass to [WrapperWidgetUI](https://storybook-react.carto.com/?path=/docs/widgets-wrapperwidgetui--default)\n * @param  {Object} [props.noDataAlertProps] - Extra props to pass to [NoDataAlert]()\n * @param {Array} [props.otherSources] - Extra sources to filter based on the main source.\n */\nfunction CustomCategoryWidget(props) {\n  const {\n    id,\n    title,\n    dataSource,\n    column,\n    operationColumn,\n    operation,\n    formatter,\n    labels,\n    animation,\n    filterable,\n    searchable,\n    onError,\n    wrapperProps,\n    noDataAlertProps,\n    otherSources,\n  } = props;\n  const dispatch = useDispatch();\n  const isSourceReady = useSelector((state) => {\n    const isReady = selectAreFeaturesReadyForSource(state, dataSource);\n\n    console.log(otherSources);\n\n    return selectAreFeaturesReadyForSource(state, dataSource);\n  });\n\n  const [categoryData, setCategoryData] = useState([]);\n\n  const [isLoading, setIsLoading] = useState(true);\n\n  const filters = useSourceFilters({ dataSource, id });\n  const selectedCategories =\n    useWidgetFilterValues({ dataSource, id, column, type: FilterTypes.IN }) ||\n    EMPTY_ARRAY;\n\n  useEffect(() => {\n    setIsLoading(true);\n\n    if (isSourceReady) {\n      getCategories({\n        column,\n        operationColumn,\n        operation,\n        filters,\n        dataSource,\n      })\n        .then((data) => {\n          if (data) {\n            setIsLoading(false);\n            setCategoryData(data);\n          }\n        })\n        .catch((error) => {\n          setIsLoading(false);\n          if (onError) onError(error);\n        });\n    }\n  }, [\n    id,\n    column,\n    operationColumn,\n    operation,\n    filters,\n    dataSource,\n    setIsLoading,\n    onError,\n    isSourceReady,\n  ]);\n\n  const handleSelectedCategoriesChange = useCallback(\n    (categories) => {\n      if (categories && categories.length) {\n        dispatch(\n          addFilter({\n            id: dataSource,\n            column,\n            type: FilterTypes.IN,\n            values: categories,\n            owner: id,\n          })\n        );\n        otherSources.forEach((e) => {\n          dispatch(\n            addFilter({\n              id: e.id,\n              column: e.column,\n              type: FilterTypes.IN,\n              values: categories,\n              owner: id,\n            })\n          );\n        });\n      } else {\n        dispatch(\n          removeFilter({\n            id: dataSource,\n            column,\n          })\n        );\n        otherSources.forEach((e) => {\n          dispatch(\n            removeFilter({\n              id: e.id,\n              column: e.column,\n            })\n          );\n        });\n      }\n    },\n    [column, dataSource, id, dispatch]\n  );\n\n  return (\n    <WrapperWidgetUI title={title} isLoading={isLoading} {...wrapperProps}>\n      {categoryData.length || isLoading ? (\n        <CategoryWidgetUI\n          data={categoryData}\n          formatter={formatter}\n          labels={labels}\n          selectedCategories={selectedCategories}\n          onSelectedCategoriesChange={handleSelectedCategoriesChange}\n          animation={animation}\n          filterable={filterable}\n          searchable={searchable}\n        />\n      ) : (\n        <NoDataAlert {...noDataAlertProps} />\n      )}\n    </WrapperWidgetUI>\n  );\n}\n\nCustomCategoryWidget.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  dataSource: PropTypes.string.isRequired,\n  column: PropTypes.string.isRequired,\n  operationColumn: PropTypes.string,\n  operation: PropTypes.oneOf(Object.values(AggregationTypes)).isRequired,\n  formatter: PropTypes.func,\n  labels: PropTypes.object,\n  animation: PropTypes.bool,\n  filterable: PropTypes.bool,\n  searchable: PropTypes.bool,\n  onError: PropTypes.func,\n  wrapperProps: PropTypes.object,\n  noDataAlertProps: PropTypes.object,\n};\n\nCustomCategoryWidget.defaultProps = {\n  labels: {},\n  animation: true,\n  filterable: true,\n  searchable: true,\n  wrapperProps: {},\n  noDataAlertProps: {},\n};\n\nexport default CustomCategoryWidget;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}