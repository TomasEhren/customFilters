{"ast":null,"code":"export function extractMipmapImages(data, options) {\n  const images = new Array(options.mipMapLevels);\n  let levelWidth = options.width;\n  let levelHeight = options.height;\n  let offset = 0;\n\n  for (let i = 0; i < options.mipMapLevels; ++i) {\n    const levelSize = getLevelSize(options, levelWidth, levelHeight, data, i);\n    const levelData = getLevelData(data, i, offset, levelSize);\n    images[i] = {\n      compressed: true,\n      format: options.internalFormat,\n      data: levelData,\n      width: levelWidth,\n      height: levelHeight,\n      levelSize\n    };\n    levelWidth = Math.max(1, levelWidth >> 1);\n    levelHeight = Math.max(1, levelHeight >> 1);\n    offset += levelSize;\n  }\n\n  return images;\n}\n\nfunction getLevelData(data, index, offset, levelSize) {\n  if (!Array.isArray(data)) {\n    return new Uint8Array(data.buffer, data.byteOffset + offset, levelSize);\n  }\n\n  return data[index].levelData;\n}\n\nfunction getLevelSize(options, levelWidth, levelHeight, data, index) {\n  if (!Array.isArray(data)) {\n    return options.sizeFunction(levelWidth, levelHeight);\n  }\n\n  return options.sizeFunction(data[index]);\n}","map":{"version":3,"mappings":"AAYA,OAAO,SAASA,mBAAT,CACLC,IADK,EAELC,OAFK,EAGW;EAChB,MAAMC,MAAM,GAAG,IAAIC,KAAJ,CAAUF,OAAO,CAACG,YAAlB,CAAf;EAEA,IAAIC,UAAU,GAAGJ,OAAO,CAACK,KAAzB;EACA,IAAIC,WAAW,GAAGN,OAAO,CAACO,MAA1B;EACA,IAAIC,MAAM,GAAG,CAAb;;EAEA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,OAAO,CAACG,YAA5B,EAA0C,EAAEM,CAA5C,EAA+C;IAE7C,MAAMC,SAAS,GAAGC,YAAY,CAACX,OAAD,EAAUI,UAAV,EAAsBE,WAAtB,EAAmCP,IAAnC,EAAyCU,CAAzC,CAA9B;IAEA,MAAMG,SAAS,GAAGC,YAAY,CAACd,IAAD,EAAOU,CAAP,EAAUD,MAAV,EAAkBE,SAAlB,CAA9B;IAEAT,MAAM,CAACQ,CAAD,CAANR,GAAY;MACVa,UAAU,EAAE,IADF;MAEVC,MAAM,EAAEf,OAAO,CAACgB,cAFN;MAGVjB,IAAI,EAAEa,SAHI;MAIVP,KAAK,EAAED,UAJG;MAKVG,MAAM,EAAED,WALE;MAMVI;IANU,CAAZT;IASAG,UAAU,GAAGa,IAAI,CAACC,GAALD,CAAS,CAATA,EAAYb,UAAU,IAAI,CAA1Ba,CAAbb;IACAE,WAAW,GAAGW,IAAI,CAACC,GAALD,CAAS,CAATA,EAAYX,WAAW,IAAI,CAA3BW,CAAdX;IAEAE,MAAM,IAAIE,SAAVF;EACD;;EACD,OAAOP,MAAP;AACD;;AAED,SAASY,YAAT,CACEd,IADF,EAEEoB,KAFF,EAGEX,MAHF,EAIEE,SAJF,EAKc;EACZ,IAAI,CAACR,KAAK,CAACkB,OAANlB,CAAcH,IAAdG,CAAL,EAA0B;IACxB,OAAO,IAAImB,UAAJ,CAAetB,IAAI,CAACuB,MAApB,EAA4BvB,IAAI,CAACwB,UAALxB,GAAkBS,MAA9C,EAAsDE,SAAtD,CAAP;EACD;;EAED,OAAOX,IAAI,CAACoB,KAAD,CAAJpB,CAAYa,SAAnB;AACD;;AAED,SAASD,YAAT,CACEX,OADF,EAEEI,UAFF,EAGEE,WAHF,EAIEP,IAJF,EAKEoB,KALF,EAMU;EACR,IAAI,CAACjB,KAAK,CAACkB,OAANlB,CAAcH,IAAdG,CAAL,EAA0B;IACxB,OAAOF,OAAO,CAACwB,YAARxB,CAAqBI,UAArBJ,EAAiCM,WAAjCN,CAAP;EACD;;EACD,OAAOA,OAAO,CAACwB,YAARxB,CAAqBD,IAAI,CAACoB,KAAD,CAAzBnB,CAAP;AACD","names":["extractMipmapImages","data","options","images","Array","mipMapLevels","levelWidth","width","levelHeight","height","offset","i","levelSize","getLevelSize","levelData","getLevelData","compressed","format","internalFormat","Math","max","index","isArray","Uint8Array","buffer","byteOffset","sizeFunction"],"sources":["../../../../src/lib/utils/extract-mipmap-images.ts"],"sourcesContent":["import {CompressedTextureExtractOptions, TextureLevel} from '../../types';\n\n/**\n * Extract mipmap images from compressed texture buffer\n * @param data - binary data of compressed texture or Array of level objects\n * @param options.mipMapLevels - number of mipmap level inside image\n * @param options.width - width of 0 - level\n * @param options.height - height of 0 - level\n * @param options.sizeFunction - format-related function to calculate level size in bytes\n * @param options.internalFormat - WebGL compatible format code\n * @returns Array of the texture levels\n */\nexport function extractMipmapImages(\n  data: Uint8Array | object[],\n  options: CompressedTextureExtractOptions\n): TextureLevel[] {\n  const images = new Array(options.mipMapLevels);\n\n  let levelWidth = options.width;\n  let levelHeight = options.height;\n  let offset = 0;\n\n  for (let i = 0; i < options.mipMapLevels; ++i) {\n    // @ts-expect-error\n    const levelSize = getLevelSize(options, levelWidth, levelHeight, data, i);\n    // @ts-expect-error\n    const levelData = getLevelData(data, i, offset, levelSize);\n\n    images[i] = {\n      compressed: true,\n      format: options.internalFormat,\n      data: levelData,\n      width: levelWidth,\n      height: levelHeight,\n      levelSize\n    };\n\n    levelWidth = Math.max(1, levelWidth >> 1);\n    levelHeight = Math.max(1, levelHeight >> 1);\n\n    offset += levelSize;\n  }\n  return images;\n}\n\nfunction getLevelData(\n  data: Uint8Array,\n  index: number,\n  offset: number,\n  levelSize: number\n): Uint8Array {\n  if (!Array.isArray(data)) {\n    return new Uint8Array(data.buffer, data.byteOffset + offset, levelSize);\n  }\n\n  return data[index].levelData;\n}\n\nfunction getLevelSize(\n  options: CompressedTextureExtractOptions,\n  levelWidth: number,\n  levelHeight: number,\n  data: Uint8Array[] | object[],\n  index: number\n): number {\n  if (!Array.isArray(data)) {\n    return options.sizeFunction(levelWidth, levelHeight);\n  }\n  return options.sizeFunction(data[index]);\n}\n"]},"metadata":{},"sourceType":"module"}