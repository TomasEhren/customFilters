{"ast":null,"code":"import _classCallCheck from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport VectorTileFeature from './vector-tile-feature';\n\nvar VectorTileLayer = /*#__PURE__*/function () {\n  function VectorTileLayer(pbf, end) {\n    _classCallCheck(this, VectorTileLayer);\n\n    _defineProperty(this, \"version\", void 0);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"extent\", void 0);\n\n    _defineProperty(this, \"length\", void 0);\n\n    _defineProperty(this, \"_pbf\", void 0);\n\n    _defineProperty(this, \"_keys\", void 0);\n\n    _defineProperty(this, \"_values\", void 0);\n\n    _defineProperty(this, \"_features\", void 0);\n\n    this.version = 1;\n    this.name = '';\n    this.extent = 4096;\n    this.length = 0;\n    this._pbf = pbf;\n    this._keys = [];\n    this._values = [];\n    this._features = [];\n    pbf.readFields(readLayer, this, end);\n    this.length = this._features.length;\n  }\n\n  _createClass(VectorTileLayer, [{\n    key: \"feature\",\n    value: function feature(i, geometryInfo) {\n      if (i < 0 || i >= this._features.length) {\n        throw new Error('feature index out of bounds');\n      }\n\n      this._pbf.pos = this._features[i];\n\n      var end = this._pbf.readVarint() + this._pbf.pos;\n\n      return new VectorTileFeature(this._pbf, end, this.extent, this._keys, this._values, geometryInfo);\n    }\n  }]);\n\n  return VectorTileLayer;\n}();\n\nexport { VectorTileLayer as default };\n\nfunction readLayer(tag, layer, pbf) {\n  if (layer && pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();else if (tag === 1) layer.name = pbf.readString();else if (tag === 5) layer.extent = pbf.readVarint();else if (tag === 2) layer._features.push(pbf.pos);else if (tag === 3) layer._keys.push(pbf.readString());else if (tag === 4) layer._values.push(readValueMessage(pbf));\n  }\n}\n\nfunction readValueMessage(pbf) {\n  var value = null;\n  var end = pbf.readVarint() + pbf.pos;\n\n  while (pbf.pos < end) {\n    var tag = pbf.readVarint() >> 3;\n    value = tag === 1 ? pbf.readString() : tag === 2 ? pbf.readFloat() : tag === 3 ? pbf.readDouble() : tag === 4 ? pbf.readVarint64() : tag === 5 ? pbf.readVarint() : tag === 6 ? pbf.readSVarint() : tag === 7 ? pbf.readBoolean() : null;\n  }\n\n  return value;\n}","map":{"version":3,"mappings":"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","names":["VectorTileFeature","VectorTileLayer","constructor","pbf","end","_defineProperty","version","name","extent","length","_pbf","_keys","_values","_features","readFields","readLayer","feature","i","geometryInfo","Error","pos","readVarint","tag","layer","readString","push","readValueMessage","value","readFloat","readDouble","readVarint64","readSVarint","readBoolean"],"sources":["../../../../src/lib/binary-vector-tile/vector-tile-layer.ts"],"sourcesContent":["/* eslint-disable indent */\n// This code is forked from https://github.com/mapbox/vector-tile-js under BSD 3-clause license.\n\nimport VectorTileFeature from './vector-tile-feature';\nimport Protobuf from 'pbf';\nimport {GeojsonGeometryInfo} from '@loaders.gl/schema';\n\nexport default class VectorTileLayer {\n  version: number;\n  name: string;\n  extent: number;\n  length: number;\n  _pbf: Protobuf;\n  _keys: string[];\n  _values: (string | number | boolean | null)[];\n  _features: number[];\n  constructor(pbf: Protobuf, end: number) {\n    // Public\n    this.version = 1;\n    this.name = '';\n    this.extent = 4096;\n    this.length = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._keys = [];\n    this._values = [];\n    this._features = [];\n\n    pbf.readFields(readLayer, this, end);\n\n    this.length = this._features.length;\n  }\n\n  /**\n   * return feature `i` from this layer as a `VectorTileFeature`\n   *\n   * @param index\n   * @param geometryInfo\n   * @returns {VectorTileFeature}\n   */\n  feature(i: number, geometryInfo: GeojsonGeometryInfo): VectorTileFeature {\n    if (i < 0 || i >= this._features.length) {\n      throw new Error('feature index out of bounds');\n    }\n\n    this._pbf.pos = this._features[i];\n\n    const end = this._pbf.readVarint() + this._pbf.pos;\n    return new VectorTileFeature(\n      this._pbf,\n      end,\n      this.extent,\n      this._keys,\n      this._values,\n      geometryInfo\n    );\n  }\n}\n\n/**\n *\n * @param tag\n * @param layer\n * @param pbf\n */\nfunction readLayer(tag: number, layer?: VectorTileLayer, pbf?: Protobuf): void {\n  if (layer && pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();\n    else if (tag === 1) layer.name = pbf.readString();\n    else if (tag === 5) layer.extent = pbf.readVarint();\n    else if (tag === 2) layer._features.push(pbf.pos);\n    else if (tag === 3) layer._keys.push(pbf.readString());\n    else if (tag === 4) layer._values.push(readValueMessage(pbf));\n  }\n}\n\n/**\n *\n * @param pbf\n * @returns value\n */\nfunction readValueMessage(pbf: Protobuf) {\n  let value: string | number | boolean | null = null;\n  const end = pbf.readVarint() + pbf.pos;\n\n  while (pbf.pos < end) {\n    const tag = pbf.readVarint() >> 3;\n\n    value =\n      tag === 1\n        ? pbf.readString()\n        : tag === 2\n        ? pbf.readFloat()\n        : tag === 3\n        ? pbf.readDouble()\n        : tag === 4\n        ? pbf.readVarint64()\n        : tag === 5\n        ? pbf.readVarint()\n        : tag === 6\n        ? pbf.readSVarint()\n        : tag === 7\n        ? pbf.readBoolean()\n        : null;\n  }\n\n  return value;\n}\n"]},"metadata":{},"sourceType":"module"}