{"ast":null,"code":"import _asyncToGenerator from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _regeneratorRuntime from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/regenerator/index.js\";\nimport { assert } from '@loaders.gl/loader-utils';\nimport { getBinaryImageMetadata } from '../category-api/binary-image-api';\nexport default function parseToNodeImage(_x, _x2) {\n  return _parseToNodeImage.apply(this, arguments);\n}\n\nfunction _parseToNodeImage() {\n  _parseToNodeImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(arrayBuffer, options) {\n    var _ref, mimeType, _parseImageNode;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _ref = getBinaryImageMetadata(arrayBuffer) || {}, mimeType = _ref.mimeType;\n            _parseImageNode = globalThis._parseImageNode;\n            assert(_parseImageNode);\n            _context.next = 5;\n            return _parseImageNode(arrayBuffer, mimeType);\n\n          case 5:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _parseToNodeImage.apply(this, arguments);\n}","map":{"version":3,"mappings":";;AAEA,SAAQA,MAAR,QAAqB,0BAArB;AACA,SAAQC,sBAAR,QAAqC,kCAArC;AAgBA,wBAA8BC,gBAA9B;EAAA;AAAA;;;+EAAe,iBACbC,WADa,EAEbC,OAFa;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAA,OAIMH,sBAAsB,CAACE,WAAD,CAAtBF,IAAuC,EAJ7C,EAINI,QAJM,QAINA,QAJM;YAOPC,eAPO,GAO2BC,UAAU,CAACD,eAPtC;YAQbN,MAAM,CAACM,eAAD,CAANN;YARa;YAAA,OAWAM,eAAe,CAACH,WAAD,EAAcE,QAAd,CAXf;;UAAA;YAAA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C","names":["assert","getBinaryImageMetadata","parseToNodeImage","arrayBuffer","options","mimeType","_parseImageNode","globalThis"],"sources":["../../../../src/lib/parsers/parse-to-node-image.ts"],"sourcesContent":["import type {ImageLoaderOptions} from '../../image-loader';\nimport type {ImageDataType} from '../../types';\nimport {assert} from '@loaders.gl/loader-utils';\nimport {getBinaryImageMetadata} from '../category-api/binary-image-api';\n\n// Note: These types should be consistent with loaders.gl/polyfills\n\ntype NDArray = {\n  shape: number[];\n  data: Uint8Array;\n  width: number;\n  height: number;\n  components: number;\n  layers: number[];\n};\n\ntype ParseImageNode = (arrayBuffer: ArrayBuffer, mimeType: string) => Promise<NDArray>;\n\n// Use polyfills if installed to parsed image using get-pixels\nexport default async function parseToNodeImage(\n  arrayBuffer: ArrayBuffer,\n  options: ImageLoaderOptions\n): Promise<ImageDataType> {\n  const {mimeType} = getBinaryImageMetadata(arrayBuffer) || {};\n\n  // @ts-ignore\n  const _parseImageNode: ParseImageNode = globalThis._parseImageNode;\n  assert(_parseImageNode); // '@loaders.gl/polyfills not installed'\n\n  // @ts-expect-error TODO should we throw error in this case?\n  return await _parseImageNode(arrayBuffer, mimeType);\n}\n"]},"metadata":{},"sourceType":"module"}