{"ast":null,"code":"var _jsxFileName = \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/src/components/widgets/CustomCategoryWidget.js\";\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { addFilter, removeFilter } from '@carto/react-redux';\nimport { WrapperWidgetUI, CategoryWidgetUI, NoDataAlert } from '@carto/react-ui';\nimport { _FilterTypes as FilterTypes, AggregationTypes } from '@carto/react-core';\nimport { getCategories } from '@carto/react-widgets'; //import { getCategories } from '../models';\n//import useSourceFilters from '../hooks/useSourceFilters';\n\nimport { useSourceFilters } from '@carto/react-widgets';\nimport { selectAreFeaturesReadyForSource } from '@carto/react-redux/'; //import { useWidgetFilterValues } from '../hooks/useWidgetFilterValues';\n\nimport { useWidgetFilterValues } from '@carto/react-widgets/hooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EMPTY_ARRAY = [];\n/**\n * Renders a <CustomCategoryWidget /> component\n * @param  {object} props\n * @param  {string} props.id - ID for the widget instance.\n * @param  {string} props.title - Title to show in the widget header.\n * @param  {string} props.dataSource - ID of the data source to get the data from.\n * @param  {string} props.column - Name of the data source's column to get the data from.\n * @param  {string} [props.operationColumn] - Name of the data source's column to operate with. If not defined it will default to the one defined in `column`.\n * @param  {string} props.operation - Operation to apply to the operationColumn. Must be one of those defined in `AggregationTypes` object.\n * @param  {Function} [props.formatter] - Function to format each value returned.\n * @param  {Object} [props.labels] - Overwrite category labels.\n * @param  {boolean} [props.animation] - Enable/disable widget animations on data updates. Enabled by default.\n * @param  {boolean} [props.filterable] - Enable/disable widget filtering capabilities. Enabled by default.\n * @param  {boolean} [props.searchable] - Enable/disable widget searching capabilities. Enabled by default.\n * @param  {Function} [props.onError] - Function to handle error messages from the widget.\n * @param  {Object} [props.wrapperProps] - Extra props to pass to [WrapperWidgetUI](https://storybook-react.carto.com/?path=/docs/widgets-wrapperwidgetui--default)\n * @param  {Object} [props.noDataAlertProps] - Extra props to pass to [NoDataAlert]()\n */\n\nfunction CustomCategoryWidget(props) {\n  const {\n    id,\n    title,\n    dataSource,\n    column,\n    operationColumn,\n    operation,\n    formatter,\n    labels,\n    animation,\n    filterable,\n    searchable,\n    onError,\n    wrapperProps,\n    noDataAlertProps\n  } = props;\n  const dispatch = useDispatch();\n  const isSourceReady = useSelector(state => selectAreFeaturesReadyForSource(state, dataSource));\n  const [categoryData, setCategoryData] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const filters = useSourceFilters({\n    dataSource,\n    id\n  });\n  const selectedCategories = useWidgetFilterValues({\n    dataSource,\n    id,\n    column,\n    type: FilterTypes.IN\n  }) || EMPTY_ARRAY;\n  useEffect(() => {\n    setIsLoading(true);\n\n    if (isSourceReady) {\n      getCategories({\n        column,\n        operationColumn,\n        operation,\n        filters,\n        dataSource\n      }).then(data => {\n        if (data) {\n          setIsLoading(false);\n          setCategoryData(data);\n        }\n      }).catch(error => {\n        setIsLoading(false);\n        if (onError) onError(error);\n      });\n    }\n  }, [id, column, operationColumn, operation, filters, dataSource, setIsLoading, onError, isSourceReady]);\n  const handleSelectedCategoriesChange = useCallback(categories => {\n    if (categories && categories.length) {\n      dispatch(addFilter({\n        id: dataSource,\n        column,\n        type: FilterTypes.IN,\n        values: categories,\n        owner: id\n      }));\n    } else {\n      dispatch(removeFilter({\n        id: dataSource,\n        column\n      }));\n    }\n  }, [column, dataSource, id, dispatch]);\n  return /*#__PURE__*/_jsxDEV(WrapperWidgetUI, {\n    title: title,\n    isLoading: isLoading,\n    ...wrapperProps,\n    children: categoryData.length || isLoading ? /*#__PURE__*/_jsxDEV(CategoryWidgetUI, {\n      data: categoryData,\n      formatter: formatter,\n      labels: labels,\n      selectedCategories: selectedCategories,\n      onSelectedCategoriesChange: handleSelectedCategoriesChange,\n      animation: animation,\n      filterable: filterable,\n      searchable: searchable\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(NoDataAlert, { ...noDataAlertProps\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n}\n\nCustomCategoryWidget.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  dataSource: PropTypes.string.isRequired,\n  column: PropTypes.string.isRequired,\n  operationColumn: PropTypes.string,\n  operation: PropTypes.oneOf(Object.values(AggregationTypes)).isRequired,\n  formatter: PropTypes.func,\n  labels: PropTypes.object,\n  animation: PropTypes.bool,\n  filterable: PropTypes.bool,\n  searchable: PropTypes.bool,\n  onError: PropTypes.func,\n  wrapperProps: PropTypes.object,\n  noDataAlertProps: PropTypes.object\n};\nCustomCategoryWidget.defaultProps = {\n  labels: {},\n  animation: true,\n  filterable: true,\n  searchable: true,\n  wrapperProps: {},\n  noDataAlertProps: {}\n};\nexport default CustomCategoryWidget;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useSelector","useDispatch","PropTypes","addFilter","removeFilter","WrapperWidgetUI","CategoryWidgetUI","NoDataAlert","_FilterTypes","FilterTypes","AggregationTypes","getCategories","useSourceFilters","selectAreFeaturesReadyForSource","useWidgetFilterValues","EMPTY_ARRAY","CustomCategoryWidget","props","id","title","dataSource","column","operationColumn","operation","formatter","labels","animation","filterable","searchable","onError","wrapperProps","noDataAlertProps","dispatch","isSourceReady","state","categoryData","setCategoryData","isLoading","setIsLoading","filters","selectedCategories","type","IN","then","data","catch","error","handleSelectedCategoriesChange","categories","length","values","owner","propTypes","string","isRequired","oneOf","Object","func","object","bool","defaultProps"],"sources":["/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/src/components/widgets/CustomCategoryWidget.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { addFilter, removeFilter } from '@carto/react-redux';\nimport { WrapperWidgetUI, CategoryWidgetUI, NoDataAlert } from '@carto/react-ui';\nimport { _FilterTypes as FilterTypes, AggregationTypes } from '@carto/react-core';\nimport { getCategories } from '@carto/react-widgets';\n//import { getCategories } from '../models';\n//import useSourceFilters from '../hooks/useSourceFilters';\nimport { useSourceFilters } from '@carto/react-widgets';\nimport { selectAreFeaturesReadyForSource } from '@carto/react-redux/';\n//import { useWidgetFilterValues } from '../hooks/useWidgetFilterValues';\nimport { useWidgetFilterValues } from '@carto/react-widgets/hooks';\n\nconst EMPTY_ARRAY = [];\n\n/**\n * Renders a <CustomCategoryWidget /> component\n * @param  {object} props\n * @param  {string} props.id - ID for the widget instance.\n * @param  {string} props.title - Title to show in the widget header.\n * @param  {string} props.dataSource - ID of the data source to get the data from.\n * @param  {string} props.column - Name of the data source's column to get the data from.\n * @param  {string} [props.operationColumn] - Name of the data source's column to operate with. If not defined it will default to the one defined in `column`.\n * @param  {string} props.operation - Operation to apply to the operationColumn. Must be one of those defined in `AggregationTypes` object.\n * @param  {Function} [props.formatter] - Function to format each value returned.\n * @param  {Object} [props.labels] - Overwrite category labels.\n * @param  {boolean} [props.animation] - Enable/disable widget animations on data updates. Enabled by default.\n * @param  {boolean} [props.filterable] - Enable/disable widget filtering capabilities. Enabled by default.\n * @param  {boolean} [props.searchable] - Enable/disable widget searching capabilities. Enabled by default.\n * @param  {Function} [props.onError] - Function to handle error messages from the widget.\n * @param  {Object} [props.wrapperProps] - Extra props to pass to [WrapperWidgetUI](https://storybook-react.carto.com/?path=/docs/widgets-wrapperwidgetui--default)\n * @param  {Object} [props.noDataAlertProps] - Extra props to pass to [NoDataAlert]()\n */\nfunction CustomCategoryWidget(props) {\n  const {\n    id,\n    title,\n    dataSource,\n    column,\n    operationColumn,\n    operation,\n    formatter,\n    labels,\n    animation,\n    filterable,\n    searchable,\n    onError,\n    wrapperProps,\n    noDataAlertProps,\n  } = props;\n  const dispatch = useDispatch();\n\n  const isSourceReady = useSelector((state) =>\n    selectAreFeaturesReadyForSource(state, dataSource)\n  );\n\n  const [categoryData, setCategoryData] = useState([]);\n\n  const [isLoading, setIsLoading] = useState(true);\n\n  const filters = useSourceFilters({ dataSource, id });\n  const selectedCategories =\n    useWidgetFilterValues({ dataSource, id, column, type: FilterTypes.IN }) ||\n    EMPTY_ARRAY;\n\n  useEffect(() => {\n    setIsLoading(true);\n\n    if (isSourceReady) {\n      getCategories({\n        column,\n        operationColumn,\n        operation,\n        filters,\n        dataSource,\n      })\n        .then((data) => {\n          if (data) {\n            setIsLoading(false);\n            setCategoryData(data);\n          }\n        })\n        .catch((error) => {\n          setIsLoading(false);\n          if (onError) onError(error);\n        });\n    }\n  }, [\n    id,\n    column,\n    operationColumn,\n    operation,\n    filters,\n    dataSource,\n    setIsLoading,\n    onError,\n    isSourceReady,\n  ]);\n\n  const handleSelectedCategoriesChange = useCallback(\n    (categories) => {\n      if (categories && categories.length) {\n        dispatch(\n          addFilter({\n            id: dataSource,\n            column,\n            type: FilterTypes.IN,\n            values: categories,\n            owner: id,\n          })\n        );\n      } else {\n        dispatch(\n          removeFilter({\n            id: dataSource,\n            column,\n          })\n        );\n      }\n    },\n    [column, dataSource, id, dispatch]\n  );\n\n  return (\n    <WrapperWidgetUI title={title} isLoading={isLoading} {...wrapperProps}>\n      {categoryData.length || isLoading ? (\n        <CategoryWidgetUI\n          data={categoryData}\n          formatter={formatter}\n          labels={labels}\n          selectedCategories={selectedCategories}\n          onSelectedCategoriesChange={handleSelectedCategoriesChange}\n          animation={animation}\n          filterable={filterable}\n          searchable={searchable}\n        />\n      ) : (\n        <NoDataAlert {...noDataAlertProps} />\n      )}\n    </WrapperWidgetUI>\n  );\n}\n\nCustomCategoryWidget.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  dataSource: PropTypes.string.isRequired,\n  column: PropTypes.string.isRequired,\n  operationColumn: PropTypes.string,\n  operation: PropTypes.oneOf(Object.values(AggregationTypes)).isRequired,\n  formatter: PropTypes.func,\n  labels: PropTypes.object,\n  animation: PropTypes.bool,\n  filterable: PropTypes.bool,\n  searchable: PropTypes.bool,\n  onError: PropTypes.func,\n  wrapperProps: PropTypes.object,\n  noDataAlertProps: PropTypes.object,\n};\n\nCustomCategoryWidget.defaultProps = {\n  labels: {},\n  animation: true,\n  filterable: true,\n  searchable: true,\n  wrapperProps: {},\n  noDataAlertProps: {},\n};\n\nexport default CustomCategoryWidget;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}