{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n/* eslint-disable camelcase */\n\nvar INITIAL_STATE = {\n  outlineEnabled: false,\n  outlineRenderShadowmap: false,\n  outlineShadowmap: null\n};\n\nfunction getUniforms() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INITIAL_STATE,\n      outlineEnabled = _ref.outlineEnabled,\n      outlineRenderShadowmap = _ref.outlineRenderShadowmap,\n      outlineShadowmap = _ref.outlineShadowmap;\n\n  var uniforms = {};\n\n  if (outlineEnabled !== undefined) {\n    // ? 1.0 : 0.0;\n    uniforms.outline_uEnabled = outlineEnabled;\n  }\n\n  if (outlineRenderShadowmap !== undefined) {\n    // ? 1.0 : 0.0;\n    uniforms.outline_uRenderOutlines = outlineRenderShadowmap;\n  }\n\n  if (outlineShadowmap !== undefined) {\n    uniforms.outline_uShadowmap = outlineShadowmap;\n  }\n\n  return uniforms;\n}\n\nvar vs = \"attribute float instanceZLevel;\\nvarying float outline_vzLevel;\\nvarying vec4 outline_vPosition;\\n\\n// Set the z level for the outline shadowmap rendering\\nvoid outline_setZLevel(float zLevel) {\\n  outline_vzLevel = zLevel;\\n}\\n\\n// Store an adjusted position for texture2DProj\\nvoid outline_setUV(vec4 position) {\\n  // mat4(\\n  //   0.5, 0.0, 0.0, 0.0,\\n  //   0.0, 0.5, 0.0, 0.0,\\n  //   0.0, 0.0, 0.5, 0.0,\\n  //   0.5, 0.5, 0.5, 1.0\\n  // ) * position;\\n  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);\\n}\\n\";\nvar fs = \"uniform bool outline_uEnabled;\\nuniform bool outline_uRenderOutlines;\\nuniform sampler2D outline_uShadowmap;\\n\\nvarying float outline_vzLevel;\\n// varying vec2 outline_vUV;\\nvarying vec4 outline_vPosition;\\n\\nconst float OUTLINE_Z_LEVEL_ERROR = 0.01;\\n\\n// Return a darker color in shadowmap\\nvec4 outline_filterShadowColor(vec4 color) {\\n  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);\\n}\\n\\n// Return a darker color if in shadowmap\\nvec4 outline_filterDarkenColor(vec4 color) {\\n  if (outline_uEnabled) {\\n    float maxZLevel;\\n    if (outline_vPosition.q > 0.0) {\\n      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;\\n    } else {\\n      discard;\\n    }\\n    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {\\n      vec4(color.rgb * 0.5, color.a);\\n    } else {\\n      discard;\\n    }\\n  }\\n  return color;\\n}\\n\\n// if enabled and rendering outlines - Render depth to shadowmap\\n// if enabled and rendering colors - Return a darker color if in shadowmap\\n// if disabled, just return color\\nvec4 outline_filterColor(vec4 color) {\\n  if (outline_uEnabled) {\\n    return outline_uRenderOutlines ?\\n      outline_filterShadowColor(color) :\\n      outline_filterDarkenColor(color);\\n  }\\n  return color;\\n}\\n\";\nvar _default = {\n  name: 'outline',\n  vs: vs,\n  fs: fs,\n  getUniforms: getUniforms\n};\nexports[\"default\"] = _default;","map":{"version":3,"mappings":";;;;;;AAAA;;AACA,IAAMA,aAAkC,GAAG;EACzCC,cAAc,EAAE,KADyB;EAEzCC,sBAAsB,EAAE,KAFiB;EAGzCC,gBAAgB,EAAE;AAHuB,CAA3C;;AAMA,SAASC,WAAT,GAAmG;EAAA,+EAAfJ,aAAe;EAAA,IAA5EC,cAA4E,QAA5EA,cAA4E;EAAA,IAA5DC,sBAA4D,QAA5DA,sBAA4D;EAAA,IAApCC,gBAAoC,QAApCA,gBAAoC;;EACjG,IAAME,QAA6B,GAAG,EAAtC;;EACA,IAAIJ,cAAc,KAAKK,SAAvB,EAAkC;IAChC;IACAD,QAAQ,CAACE,gBAATF,GAA4BJ,cAA5BI;EACD;;EACD,IAAIH,sBAAsB,KAAKI,SAA/B,EAA0C;IACxC;IACAD,QAAQ,CAACG,uBAATH,GAAmCH,sBAAnCG;EACD;;EACD,IAAIF,gBAAgB,KAAKG,SAAzB,EAAoC;IAClCD,QAAQ,CAACI,kBAATJ,GAA8BF,gBAA9BE;EACD;;EACD,OAAOA,QAAP;AACD;;AAED,IAAMK,EAAE,miBAAR;AAsBA,IAAMC,EAAE,4wCAAR;eA+Ce;EACbC,IAAI,EAAE,SADO;EAEbF,EAAE,EAAFA,EAFa;EAGbC,EAAE,EAAFA,EAHa;EAIbP,WAAW,EAAXA;AAJa","names":["INITIAL_STATE","outlineEnabled","outlineRenderShadowmap","outlineShadowmap","getUniforms","uniforms","undefined","outline_uEnabled","outline_uRenderOutlines","outline_uShadowmap","vs","fs","name"],"sources":["../../../src/shaderlib/outline/outline.ts"],"sourcesContent":["/* eslint-disable camelcase */\nconst INITIAL_STATE: Record<string, any> = {\n  outlineEnabled: false,\n  outlineRenderShadowmap: false,\n  outlineShadowmap: null,\n};\n\nfunction getUniforms({ outlineEnabled, outlineRenderShadowmap, outlineShadowmap } = INITIAL_STATE) {\n  const uniforms: Record<string, any> = {};\n  if (outlineEnabled !== undefined) {\n    // ? 1.0 : 0.0;\n    uniforms.outline_uEnabled = outlineEnabled;\n  }\n  if (outlineRenderShadowmap !== undefined) {\n    // ? 1.0 : 0.0;\n    uniforms.outline_uRenderOutlines = outlineRenderShadowmap;\n  }\n  if (outlineShadowmap !== undefined) {\n    uniforms.outline_uShadowmap = outlineShadowmap;\n  }\n  return uniforms;\n}\n\nconst vs = `\\\nattribute float instanceZLevel;\nvarying float outline_vzLevel;\nvarying vec4 outline_vPosition;\n\n// Set the z level for the outline shadowmap rendering\nvoid outline_setZLevel(float zLevel) {\n  outline_vzLevel = zLevel;\n}\n\n// Store an adjusted position for texture2DProj\nvoid outline_setUV(vec4 position) {\n  // mat4(\n  //   0.5, 0.0, 0.0, 0.0,\n  //   0.0, 0.5, 0.0, 0.0,\n  //   0.0, 0.0, 0.5, 0.0,\n  //   0.5, 0.5, 0.5, 1.0\n  // ) * position;\n  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);\n}\n`;\n\nconst fs = `\\\nuniform bool outline_uEnabled;\nuniform bool outline_uRenderOutlines;\nuniform sampler2D outline_uShadowmap;\n\nvarying float outline_vzLevel;\n// varying vec2 outline_vUV;\nvarying vec4 outline_vPosition;\n\nconst float OUTLINE_Z_LEVEL_ERROR = 0.01;\n\n// Return a darker color in shadowmap\nvec4 outline_filterShadowColor(vec4 color) {\n  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);\n}\n\n// Return a darker color if in shadowmap\nvec4 outline_filterDarkenColor(vec4 color) {\n  if (outline_uEnabled) {\n    float maxZLevel;\n    if (outline_vPosition.q > 0.0) {\n      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;\n    } else {\n      discard;\n    }\n    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {\n      vec4(color.rgb * 0.5, color.a);\n    } else {\n      discard;\n    }\n  }\n  return color;\n}\n\n// if enabled and rendering outlines - Render depth to shadowmap\n// if enabled and rendering colors - Return a darker color if in shadowmap\n// if disabled, just return color\nvec4 outline_filterColor(vec4 color) {\n  if (outline_uEnabled) {\n    return outline_uRenderOutlines ?\n      outline_filterShadowColor(color) :\n      outline_filterDarkenColor(color);\n  }\n  return color;\n}\n`;\n\nexport default {\n  name: 'outline',\n  vs,\n  fs,\n  getUniforms,\n};\n"]},"metadata":{},"sourceType":"script"}