{"ast":null,"code":"import _classCallCheck from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/tomasehrenfeld/projs/se-team/tomas/react-apps/custom_filter/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { GL, GLType } from '@loaders.gl/math';\n\nvar Tile3DFeatureTable = /*#__PURE__*/function () {\n  function Tile3DFeatureTable(featureTableJson, featureTableBinary) {\n    _classCallCheck(this, Tile3DFeatureTable);\n\n    _defineProperty(this, \"json\", void 0);\n\n    _defineProperty(this, \"buffer\", void 0);\n\n    _defineProperty(this, \"featuresLength\", 0);\n\n    _defineProperty(this, \"_cachedTypedArrays\", {});\n\n    this.json = featureTableJson;\n    this.buffer = featureTableBinary;\n  }\n\n  _createClass(Tile3DFeatureTable, [{\n    key: \"getExtension\",\n    value: function getExtension(extensionName) {\n      return this.json.extensions && this.json.extensions[extensionName];\n    }\n  }, {\n    key: \"hasProperty\",\n    value: function hasProperty(propertyName) {\n      return Boolean(this.json[propertyName]);\n    }\n  }, {\n    key: \"getGlobalProperty\",\n    value: function getGlobalProperty(propertyName) {\n      var componentType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : GL.UNSIGNED_INT;\n      var componentLength = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n      var jsonValue = this.json[propertyName];\n\n      if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n        return this._getTypedArrayFromBinary(propertyName, componentType, componentLength, 1, jsonValue.byteOffset);\n      }\n\n      return jsonValue;\n    }\n  }, {\n    key: \"getPropertyArray\",\n    value: function getPropertyArray(propertyName, componentType, componentLength) {\n      var jsonValue = this.json[propertyName];\n\n      if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n        if ('componentType' in jsonValue) {\n          componentType = GLType.fromName(jsonValue.componentType);\n        }\n\n        return this._getTypedArrayFromBinary(propertyName, componentType, componentLength, this.featuresLength, jsonValue.byteOffset);\n      }\n\n      return this._getTypedArrayFromArray(propertyName, componentType, jsonValue);\n    }\n  }, {\n    key: \"getProperty\",\n    value: function getProperty(propertyName, componentType, componentLength, featureId, result) {\n      var jsonValue = this.json[propertyName];\n\n      if (!jsonValue) {\n        return jsonValue;\n      }\n\n      var typedArray = this.getPropertyArray(propertyName, componentType, componentLength);\n\n      if (componentLength === 1) {\n        return typedArray[featureId];\n      }\n\n      for (var i = 0; i < componentLength; ++i) {\n        result[i] = typedArray[componentLength * featureId + i];\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_getTypedArrayFromBinary\",\n    value: function _getTypedArrayFromBinary(propertyName, componentType, componentLength, count, byteOffset) {\n      var cachedTypedArrays = this._cachedTypedArrays;\n      var typedArray = cachedTypedArrays[propertyName];\n\n      if (!typedArray) {\n        typedArray = GLType.createTypedArray(componentType, this.buffer.buffer, this.buffer.byteOffset + byteOffset, count * componentLength);\n        cachedTypedArrays[propertyName] = typedArray;\n      }\n\n      return typedArray;\n    }\n  }, {\n    key: \"_getTypedArrayFromArray\",\n    value: function _getTypedArrayFromArray(propertyName, componentType, array) {\n      var cachedTypedArrays = this._cachedTypedArrays;\n      var typedArray = cachedTypedArrays[propertyName];\n\n      if (!typedArray) {\n        typedArray = GLType.createTypedArray(componentType, array);\n        cachedTypedArrays[propertyName] = typedArray;\n      }\n\n      return typedArray;\n    }\n  }]);\n\n  return Tile3DFeatureTable;\n}();\n\nexport { Tile3DFeatureTable as default };","map":{"version":3,"mappings":";;;AAGA,SAAQA,EAAR,EAAYC,MAAZ,QAAyB,kBAAzB;;IAIqBC,kB;EAMnBC,4BAAYC,gBAAZD,EAA8BE,kBAA9BF,EAAkD;IAAA;;IAAAG;;IAAAA;;IAAAA,wCAHjC,CAGiC;;IAAAA,4CAF7B,EAE6B;;IAChD,KAAKC,IAAL,GAAYH,gBAAZ;IACA,KAAKI,MAAL,GAAcH,kBAAd;EACD;;;;WAEDI,sBAAaC,aAAbD,EAA4B;MAC1B,OAAO,KAAKF,IAAL,CAAUI,UAAV,IAAwB,KAAKJ,IAAL,CAAUI,UAAV,CAAqBD,aAArB,CAA/B;IACD;;;WAEDE,qBAAYC,YAAZD,EAA0B;MACxB,OAAOE,OAAO,CAAC,KAAKP,IAAL,CAAUM,YAAV,CAAD,CAAd;IACD;;;WAEDE,2BAAkBF,YAAlBE,EAAsF;MAAA,IAAtDC,aAAsD,uEAAtChB,EAAE,CAACiB,YAAmC;MAAA,IAArBC,eAAqB,uEAAH,CAAG;MACpF,IAAMC,SAAS,GAAG,KAAKZ,IAAL,CAAUM,YAAV,CAAlB;;MAEA,IAAIM,SAAS,IAAIC,MAAM,CAACC,QAAPD,CAAgBD,SAAS,CAACG,UAA1BF,CAAjB,EAAwD;QACtD,OAAO,KAAKG,wBAAL,CACLV,YADK,EAELG,aAFK,EAGLE,eAHK,EAIL,CAJK,EAKLC,SAAS,CAACG,UALL,CAAP;MAOD;;MAED,OAAOH,SAAP;IACD;;;WAEDK,0BAAiBX,YAAjBW,EAA+BR,aAA/BQ,EAA8CN,eAA9CM,EAA+D;MAC7D,IAAML,SAAS,GAAG,KAAKZ,IAAL,CAAUM,YAAV,CAAlB;;MAEA,IAAIM,SAAS,IAAIC,MAAM,CAACC,QAAPD,CAAgBD,SAAS,CAACG,UAA1BF,CAAjB,EAAwD;QACtD,IAAI,mBAAmBD,SAAvB,EAAkC;UAChCH,aAAa,GAAGf,MAAM,CAACwB,QAAPxB,CAAgBkB,SAAS,CAACH,aAA1Bf,CAAhBe;QACD;;QACD,OAAO,KAAKO,wBAAL,CACLV,YADK,EAELG,aAFK,EAGLE,eAHK,EAIL,KAAKQ,cAJA,EAKLP,SAAS,CAACG,UALL,CAAP;MAOD;;MAED,OAAO,KAAKK,uBAAL,CAA6Bd,YAA7B,EAA2CG,aAA3C,EAA0DG,SAA1D,CAAP;IACD;;;WAEDS,qBAAYf,YAAZe,EAA0BZ,aAA1BY,EAAyCV,eAAzCU,EAA0DC,SAA1DD,EAAqEE,MAArEF,EAA6E;MAC3E,IAAMT,SAAS,GAAG,KAAKZ,IAAL,CAAUM,YAAV,CAAlB;;MACA,IAAI,CAACM,SAAL,EAAgB;QACd,OAAOA,SAAP;MACD;;MAED,IAAMY,UAAU,GAAG,KAAKP,gBAAL,CAAsBX,YAAtB,EAAoCG,aAApC,EAAmDE,eAAnD,CAAnB;;MAEA,IAAIA,eAAe,KAAK,CAAxB,EAA2B;QACzB,OAAOa,UAAU,CAACF,SAAD,CAAjB;MACD;;MAED,KAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGd,eAApB,EAAqC,EAAEc,CAAvC,EAA0C;QACxCF,MAAM,CAACE,CAAD,CAANF,GAAYC,UAAU,CAACb,eAAe,GAAGW,SAAlBX,GAA8Bc,CAA/B,CAAtBF;MACD;;MAED,OAAOA,MAAP;IACD;;;WAIDP,kCAAyBV,YAAzBU,EAAuCP,aAAvCO,EAAsDL,eAAtDK,EAAuEU,KAAvEV,EAA8ED,UAA9EC,EAA0F;MACxF,IAAMW,iBAAiB,GAAG,KAAKC,kBAA/B;MACA,IAAIJ,UAAU,GAAGG,iBAAiB,CAACrB,YAAD,CAAlC;;MACA,IAAI,CAACkB,UAAL,EAAiB;QACfA,UAAU,GAAG9B,MAAM,CAACmC,gBAAPnC,CACXe,aADWf,EAEX,KAAKO,MAAL,CAAYA,MAFDP,EAGX,KAAKO,MAAL,CAAYc,UAAZ,GAAyBA,UAHdrB,EAIXgC,KAAK,GAAGf,eAJGjB,CAAb8B;QAMAG,iBAAiB,CAACrB,YAAD,CAAjBqB,GAAkCH,UAAlCG;MACD;;MACD,OAAOH,UAAP;IACD;;;WAEDJ,iCAAwBd,YAAxBc,EAAsCX,aAAtCW,EAAqDU,KAArDV,EAA4D;MAC1D,IAAMO,iBAAiB,GAAG,KAAKC,kBAA/B;MACA,IAAIJ,UAAU,GAAGG,iBAAiB,CAACrB,YAAD,CAAlC;;MACA,IAAI,CAACkB,UAAL,EAAiB;QACfA,UAAU,GAAG9B,MAAM,CAACmC,gBAAPnC,CAAwBe,aAAxBf,EAAuCoC,KAAvCpC,CAAb8B;QACAG,iBAAiB,CAACrB,YAAD,CAAjBqB,GAAkCH,UAAlCG;MACD;;MACD,OAAOH,UAAP;IACD;;;;;;SAlGkB7B,kB","names":["GL","GLType","Tile3DFeatureTable","constructor","featureTableJson","featureTableBinary","_defineProperty","json","buffer","getExtension","extensionName","extensions","hasProperty","propertyName","Boolean","getGlobalProperty","componentType","UNSIGNED_INT","componentLength","jsonValue","Number","isFinite","byteOffset","_getTypedArrayFromBinary","getPropertyArray","fromName","featuresLength","_getTypedArrayFromArray","getProperty","featureId","result","typedArray","i","count","cachedTypedArrays","_cachedTypedArrays","createTypedArray","array"],"sources":["../../../../src/lib/classes/tile-3d-feature-table.ts"],"sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {GL, GLType} from '@loaders.gl/math';\n\n// Reference:\n// https://github.com/AnalyticalGraphicsInc/cesium/blob/1de96d087f0b17575eb1a3f736407b348c765d59/Source/Scene/Cesium3DTileFeatureTable.js\nexport default class Tile3DFeatureTable {\n  json;\n  buffer;\n  featuresLength = 0;\n  _cachedTypedArrays = {};\n\n  constructor(featureTableJson, featureTableBinary) {\n    this.json = featureTableJson;\n    this.buffer = featureTableBinary;\n  }\n\n  getExtension(extensionName) {\n    return this.json.extensions && this.json.extensions[extensionName];\n  }\n\n  hasProperty(propertyName) {\n    return Boolean(this.json[propertyName]);\n  }\n\n  getGlobalProperty(propertyName, componentType = GL.UNSIGNED_INT, componentLength = 1) {\n    const jsonValue = this.json[propertyName];\n\n    if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n      return this._getTypedArrayFromBinary(\n        propertyName,\n        componentType,\n        componentLength,\n        1,\n        jsonValue.byteOffset\n      );\n    }\n\n    return jsonValue;\n  }\n\n  getPropertyArray(propertyName, componentType, componentLength) {\n    const jsonValue = this.json[propertyName];\n\n    if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n      if ('componentType' in jsonValue) {\n        componentType = GLType.fromName(jsonValue.componentType);\n      }\n      return this._getTypedArrayFromBinary(\n        propertyName,\n        componentType,\n        componentLength,\n        this.featuresLength,\n        jsonValue.byteOffset\n      );\n    }\n\n    return this._getTypedArrayFromArray(propertyName, componentType, jsonValue);\n  }\n\n  getProperty(propertyName, componentType, componentLength, featureId, result) {\n    const jsonValue = this.json[propertyName];\n    if (!jsonValue) {\n      return jsonValue;\n    }\n\n    const typedArray = this.getPropertyArray(propertyName, componentType, componentLength);\n\n    if (componentLength === 1) {\n      return typedArray[featureId];\n    }\n\n    for (let i = 0; i < componentLength; ++i) {\n      result[i] = typedArray[componentLength * featureId + i];\n    }\n\n    return result;\n  }\n\n  // HELPERS\n\n  _getTypedArrayFromBinary(propertyName, componentType, componentLength, count, byteOffset) {\n    const cachedTypedArrays = this._cachedTypedArrays;\n    let typedArray = cachedTypedArrays[propertyName];\n    if (!typedArray) {\n      typedArray = GLType.createTypedArray(\n        componentType,\n        this.buffer.buffer,\n        this.buffer.byteOffset + byteOffset,\n        count * componentLength\n      );\n      cachedTypedArrays[propertyName] = typedArray;\n    }\n    return typedArray;\n  }\n\n  _getTypedArrayFromArray(propertyName, componentType, array) {\n    const cachedTypedArrays = this._cachedTypedArrays;\n    let typedArray = cachedTypedArrays[propertyName];\n    if (!typedArray) {\n      typedArray = GLType.createTypedArray(componentType, array);\n      cachedTypedArrays[propertyName] = typedArray;\n    }\n    return typedArray;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}