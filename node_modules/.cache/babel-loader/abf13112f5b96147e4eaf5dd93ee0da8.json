{"ast":null,"code":"import { createElement } from 'react';\nimport { View } from '@deck.gl/core';\nimport { inheritsFrom } from './inherits-from';\nimport evaluateChildren from './evaluate-children';\nexport default function positionChildrenUnderViews(_ref) {\n  let {\n    children,\n    deck,\n    ContextProvider\n  } = _ref;\n  const {\n    viewManager\n  } = deck || {};\n\n  if (!viewManager || !viewManager.views.length) {\n    return [];\n  }\n\n  const views = {};\n  const defaultViewId = viewManager.views[0].id;\n\n  for (const child of children) {\n    let viewId = defaultViewId;\n    let viewChildren = child;\n\n    if (inheritsFrom(child.type, View)) {\n      viewId = child.props.id || defaultViewId;\n      viewChildren = child.props.children;\n    }\n\n    const viewport = viewManager.getViewport(viewId);\n    const viewState = viewManager.getViewState(viewId);\n\n    if (viewport) {\n      const {\n        x,\n        y,\n        width,\n        height\n      } = viewport;\n      viewChildren = evaluateChildren(viewChildren, {\n        x,\n        y,\n        width,\n        height,\n        viewport,\n        viewState\n      });\n\n      if (!views[viewId]) {\n        views[viewId] = {\n          viewport,\n          children: []\n        };\n      }\n\n      views[viewId].children.push(viewChildren);\n    }\n  }\n\n  return Object.keys(views).map(viewId => {\n    const {\n      viewport,\n      children: viewChildren\n    } = views[viewId];\n    const {\n      x,\n      y,\n      width,\n      height\n    } = viewport;\n    const style = {\n      position: 'absolute',\n      left: x,\n      top: y,\n      width,\n      height\n    };\n    const key = \"view-\".concat(viewId);\n    const viewElement = createElement('div', {\n      key,\n      id: key,\n      style\n    }, ...viewChildren);\n\n    if (ContextProvider) {\n      const contextValue = {\n        viewport,\n        container: deck.canvas.offsetParent,\n        eventManager: deck.eventManager,\n        onViewStateChange: params => {\n          params.viewId = viewId;\n\n          deck._onViewStateChange(params);\n        }\n      };\n      return createElement(ContextProvider, {\n        key,\n        value: contextValue\n      }, viewElement);\n    }\n\n    return viewElement;\n  });\n}","map":{"version":3,"mappings":"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","names":["createElement","View","inheritsFrom","evaluateChildren","positionChildrenUnderViews","children","deck","ContextProvider","viewManager","views","length","defaultViewId","id","child","viewId","viewChildren","type","props","viewport","getViewport","viewState","getViewState","x","y","width","height","push","Object","keys","map","style","position","left","top","key","viewElement","contextValue","container","canvas","offsetParent","eventManager","onViewStateChange","params","_onViewStateChange","value"],"sources":["../../../src/utils/position-children-under-views.js"],"sourcesContent":["import {createElement} from 'react';\nimport {View} from '@deck.gl/core';\nimport {inheritsFrom} from './inherits-from';\nimport evaluateChildren from './evaluate-children';\n\n// Iterate over views and reposition children associated with views\n// TODO - Can we supply a similar function for the non-React case?\nexport default function positionChildrenUnderViews({children, deck, ContextProvider}) {\n  const {viewManager} = deck || {};\n\n  if (!viewManager || !viewManager.views.length) {\n    return [];\n  }\n\n  const views = {};\n  const defaultViewId = viewManager.views[0].id;\n\n  // Sort children by view id\n  for (const child of children) {\n    // Unless child is a View, position / render as part of the default view\n    let viewId = defaultViewId;\n    let viewChildren = child;\n\n    if (inheritsFrom(child.type, View)) {\n      viewId = child.props.id || defaultViewId;\n      viewChildren = child.props.children;\n    }\n\n    const viewport = viewManager.getViewport(viewId);\n    const viewState = viewManager.getViewState(viewId);\n\n    // Drop (auto-hide) elements with viewId that are not matched by any current view\n    if (viewport) {\n      const {x, y, width, height} = viewport;\n      // Resolve potentially relative dimensions using the deck.gl container size\n      viewChildren = evaluateChildren(viewChildren, {\n        x,\n        y,\n        width,\n        height,\n        viewport,\n        viewState\n      });\n\n      if (!views[viewId]) {\n        views[viewId] = {\n          viewport,\n          children: []\n        };\n      }\n      views[viewId].children.push(viewChildren);\n    }\n  }\n\n  // Render views\n  return Object.keys(views).map(viewId => {\n    const {viewport, children: viewChildren} = views[viewId];\n    const {x, y, width, height} = viewport;\n    const style = {\n      position: 'absolute',\n      left: x,\n      top: y,\n      width,\n      height\n    };\n\n    const key = `view-${viewId}`;\n    // If children is passed as an array, React will throw the \"each element in a list needs\n    // a key\" warning. Sending each child as separate arguments removes this requirement.\n    const viewElement = createElement('div', {key, id: key, style}, ...viewChildren);\n\n    if (ContextProvider) {\n      const contextValue = {\n        viewport,\n        container: deck.canvas.offsetParent,\n        eventManager: deck.eventManager,\n        onViewStateChange: params => {\n          params.viewId = viewId;\n          deck._onViewStateChange(params);\n        }\n      };\n      return createElement(ContextProvider, {key, value: contextValue}, viewElement);\n    }\n\n    return viewElement;\n  });\n}\n"]},"metadata":{},"sourceType":"module"}