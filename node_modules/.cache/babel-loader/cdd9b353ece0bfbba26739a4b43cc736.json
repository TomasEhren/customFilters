{"ast":null,"code":"import { global } from 'probe.gl/env';\nconst glErrorShadow = {};\n\nfunction error(msg) {\n  if (global.console && global.console.error) {\n    global.console.error(msg);\n  }\n}\n\nfunction log(msg) {\n  if (global.console && global.console.log) {\n    global.console.log(msg);\n  }\n}\n\nfunction synthesizeGLError(err, opt_msg) {\n  glErrorShadow[err] = true;\n\n  if (opt_msg !== undefined) {\n    error(opt_msg);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const f = gl.getError;\n\n  gl.getError = function getError() {\n    let err;\n\n    do {\n      err = f.apply(gl);\n\n      if (err !== 0) {\n        glErrorShadow[err] = true;\n      }\n    } while (err !== 0);\n\n    for (err in glErrorShadow) {\n      if (glErrorShadow[err]) {\n        delete glErrorShadow[err];\n        return parseInt(err, 10);\n      }\n    }\n\n    return 0;\n  };\n}\n\nconst WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n  const gl = ext.gl;\n  this.ext = ext;\n  this.isAlive = true;\n  this.hasBeenBound = false;\n  this.elementArrayBuffer = null;\n  this.attribs = new Array(ext.maxVertexAttribs);\n\n  for (let n = 0; n < this.attribs.length; n++) {\n    const attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n    this.attribs[n] = attrib;\n  }\n\n  this.maxAttrib = 0;\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n  this.enabled = false;\n  this.buffer = null;\n  this.size = 4;\n  this.type = 5126;\n  this.normalized = false;\n  this.stride = 16;\n  this.offset = 0;\n  this.cached = '';\n  this.recache();\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n  this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n};\n\nconst OESVertexArrayObject = function OESVertexArrayObject(gl) {\n  const self = this;\n  this.gl = gl;\n  wrapGLError(gl);\n  const original = this.original = {\n    getParameter: gl.getParameter,\n    enableVertexAttribArray: gl.enableVertexAttribArray,\n    disableVertexAttribArray: gl.disableVertexAttribArray,\n    bindBuffer: gl.bindBuffer,\n    getVertexAttrib: gl.getVertexAttrib,\n    vertexAttribPointer: gl.vertexAttribPointer\n  };\n\n  gl.getParameter = function getParameter(pname) {\n    if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n      if (self.currentVertexArrayObject === self.defaultVertexArrayObject) {\n        return null;\n      }\n\n      return self.currentVertexArrayObject;\n    }\n\n    return original.getParameter.apply(this, arguments);\n  };\n\n  gl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = true;\n    return original.enableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = false;\n    return original.disableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.bindBuffer = function bindBuffer(target, buffer) {\n    switch (target) {\n      case 34962:\n        self.currentArrayBuffer = buffer;\n        break;\n\n      case 34963:\n        self.currentVertexArrayObject.elementArrayBuffer = buffer;\n        break;\n\n      default:\n    }\n\n    return original.bindBuffer.apply(this, arguments);\n  };\n\n  gl.getVertexAttrib = function getVertexAttrib(index, pname) {\n    const vao = self.currentVertexArrayObject;\n    const attrib = vao.attribs[index];\n\n    switch (pname) {\n      case 34975:\n        return attrib.buffer;\n\n      case 34338:\n        return attrib.enabled;\n\n      case 34339:\n        return attrib.size;\n\n      case 34340:\n        return attrib.stride;\n\n      case 34341:\n        return attrib.type;\n\n      case 34922:\n        return attrib.normalized;\n\n      default:\n        return original.getVertexAttrib.apply(this, arguments);\n    }\n  };\n\n  gl.vertexAttribPointer = function vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n    const attrib = vao.attribs[indx];\n    attrib.buffer = self.currentArrayBuffer;\n    attrib.size = size;\n    attrib.type = type;\n    attrib.normalized = normalized;\n    attrib.stride = stride;\n    attrib.offset = offset;\n    attrib.recache();\n    return original.vertexAttribPointer.apply(this, arguments);\n  };\n\n  if (gl.instrumentExtension) {\n    gl.instrumentExtension(this, 'OES_vertex_array_object');\n  }\n\n  if (gl.canvas) {\n    gl.canvas.addEventListener('webglcontextrestored', () => {\n      log('OESVertexArrayObject emulation library context restored');\n      self.reset_();\n    }, true);\n  }\n\n  this.reset_();\n};\n\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85b5;\n\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n  const contextWasLost = this.vertexArrayObjects !== undefined;\n\n  if (contextWasLost) {\n    for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n      this.vertexArrayObjects.isAlive = false;\n    }\n  }\n\n  const gl = this.gl;\n  this.maxVertexAttribs = gl.getParameter(34921);\n  this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n  this.currentVertexArrayObject = null;\n  this.currentArrayBuffer = null;\n  this.vertexArrayObjects = [this.defaultVertexArrayObject];\n  this.bindVertexArrayOES(null);\n};\n\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n  const arrayObject = new WebGLVertexArrayObjectOES(this);\n  this.vertexArrayObjects.push(arrayObject);\n  return arrayObject;\n};\n\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n  arrayObject.isAlive = false;\n  this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n\n  if (this.currentVertexArrayObject === arrayObject) {\n    this.bindVertexArrayOES(null);\n  }\n};\n\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n  if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n    if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n  const gl = this.gl;\n\n  if (arrayObject && !arrayObject.isAlive) {\n    synthesizeGLError(1282, 'bindVertexArrayOES: attempt to bind deleted arrayObject');\n    return;\n  }\n\n  const original = this.original;\n  const oldVAO = this.currentVertexArrayObject;\n  this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n  this.currentVertexArrayObject.hasBeenBound = true;\n  const newVAO = this.currentVertexArrayObject;\n\n  if (oldVAO === newVAO) {\n    return;\n  }\n\n  if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n    original.bindBuffer.call(gl, 34963, newVAO.elementArrayBuffer);\n  }\n\n  let currentBinding = this.currentArrayBuffer;\n  const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n\n  for (let n = 0; n <= maxAttrib; n++) {\n    const attrib = newVAO.attribs[n];\n    const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n    if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n      if (attrib.enabled) {\n        original.enableVertexAttribArray.call(gl, n);\n      } else {\n        original.disableVertexAttribArray.call(gl, n);\n      }\n    }\n\n    if (attrib.enabled) {\n      let bufferChanged = false;\n\n      if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n        if (currentBinding !== attrib.buffer) {\n          original.bindBuffer.call(gl, 34962, attrib.buffer);\n          currentBinding = attrib.buffer;\n        }\n\n        bufferChanged = true;\n      }\n\n      if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n        original.vertexAttribPointer.call(gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n      }\n    }\n  }\n\n  if (this.currentArrayBuffer !== currentBinding) {\n    original.bindBuffer.call(gl, 34962, this.currentArrayBuffer);\n  }\n};\n\nexport function polyfillVertexArrayObject(gl) {\n  if (typeof gl.createVertexArray === 'function') {\n    return;\n  }\n\n  const original_getSupportedExtensions = gl.getSupportedExtensions;\n\n  gl.getSupportedExtensions = function getSupportedExtensions() {\n    const list = original_getSupportedExtensions.call(this) || [];\n\n    if (list.indexOf('OES_vertex_array_object') < 0) {\n      list.push('OES_vertex_array_object');\n    }\n\n    return list;\n  };\n\n  const original_getExtension = gl.getExtension;\n\n  gl.getExtension = function getExtension(name) {\n    const ext = original_getExtension.call(this, name);\n\n    if (ext) {\n      return ext;\n    }\n\n    if (name !== 'OES_vertex_array_object') {\n      return null;\n    }\n\n    if (!gl.__OESVertexArrayObject) {\n      this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n    }\n\n    return this.__OESVertexArrayObject;\n  };\n}","map":{"version":3,"mappings":"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","names":["global","glErrorShadow","error","msg","console","log","synthesizeGLError","err","opt_msg","undefined","wrapGLError","gl","f","getError","apply","parseInt","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","VertexAttrib","maxAttrib","enabled","buffer","size","type","normalized","stride","offset","cached","recache","prototype","join","OESVertexArrayObject","self","original","getParameter","enableVertexAttribArray","disableVertexAttribArray","bindBuffer","getVertexAttrib","vertexAttribPointer","pname","VERTEX_ARRAY_BINDING_OES","currentVertexArrayObject","defaultVertexArrayObject","arguments","index","vao","Math","max","target","currentArrayBuffer","indx","instrumentExtension","canvas","addEventListener","reset_","contextWasLost","vertexArrayObjects","ii","bindVertexArrayOES","createVertexArrayOES","arrayObject","push","deleteVertexArrayOES","splice","indexOf","isVertexArrayOES","oldVAO","newVAO","call","currentBinding","oldAttrib","bufferChanged","polyfillVertexArrayObject","createVertexArray","original_getSupportedExtensions","getSupportedExtensions","list","original_getExtension","getExtension","name","__OESVertexArrayObject"],"sources":["../../../src/polyfill/polyfill-vertex-array-object.js"],"sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** \"Materials\"), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// Modified to use ES6 and polyfill a provided context rather than\n// the global class.\n\n// @ts-nocheck external code\n\nimport {global} from 'probe.gl/env';\n\nconst glErrorShadow = {};\n\nfunction error(msg) {\n  if (global.console && global.console.error) {\n    global.console.error(msg);\n  }\n}\n\nfunction log(msg) {\n  if (global.console && global.console.log) {\n    global.console.log(msg);\n  }\n}\n\nfunction synthesizeGLError(err, opt_msg) {\n  glErrorShadow[err] = true;\n  if (opt_msg !== undefined) {\n    error(opt_msg);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const f = gl.getError;\n  gl.getError = function getError() {\n    let err;\n    do {\n      err = f.apply(gl);\n      if (err !== gl.NO_ERROR) {\n        glErrorShadow[err] = true;\n      }\n    } while (err !== gl.NO_ERROR);\n\n    for (err in glErrorShadow) {\n      if (glErrorShadow[err]) {\n        delete glErrorShadow[err];\n        return parseInt(err, 10);\n      }\n    }\n\n    return gl.NO_ERROR;\n  };\n}\n\nconst WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n  const gl = ext.gl;\n\n  this.ext = ext;\n  this.isAlive = true;\n  this.hasBeenBound = false;\n\n  this.elementArrayBuffer = null;\n  this.attribs = new Array(ext.maxVertexAttribs);\n  for (let n = 0; n < this.attribs.length; n++) {\n    const attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n    this.attribs[n] = attrib;\n  }\n\n  this.maxAttrib = 0;\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n  this.enabled = false;\n  this.buffer = null;\n  this.size = 4;\n  this.type = gl.FLOAT;\n  this.normalized = false;\n  this.stride = 16;\n  this.offset = 0;\n\n  this.cached = '';\n  this.recache();\n};\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n  this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n};\n\nconst OESVertexArrayObject = function OESVertexArrayObject(gl) {\n  const self = this;\n  this.gl = gl;\n\n  wrapGLError(gl);\n\n  const original = (this.original = {\n    getParameter: gl.getParameter,\n    enableVertexAttribArray: gl.enableVertexAttribArray,\n    disableVertexAttribArray: gl.disableVertexAttribArray,\n    bindBuffer: gl.bindBuffer,\n    getVertexAttrib: gl.getVertexAttrib,\n    vertexAttribPointer: gl.vertexAttribPointer\n  });\n\n  gl.getParameter = function getParameter(pname) {\n    if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n      if (self.currentVertexArrayObject === self.defaultVertexArrayObject) {\n        return null;\n      }\n      return self.currentVertexArrayObject;\n    }\n    return original.getParameter.apply(this, arguments);\n  };\n\n  gl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = true;\n    return original.enableVertexAttribArray.apply(this, arguments);\n  };\n  gl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = false;\n    return original.disableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.bindBuffer = function bindBuffer(target, buffer) {\n    switch (target) {\n      case gl.ARRAY_BUFFER:\n        self.currentArrayBuffer = buffer;\n        break;\n      case gl.ELEMENT_ARRAY_BUFFER:\n        self.currentVertexArrayObject.elementArrayBuffer = buffer;\n        break;\n      default:\n    }\n    return original.bindBuffer.apply(this, arguments);\n  };\n\n  gl.getVertexAttrib = function getVertexAttrib(index, pname) {\n    const vao = self.currentVertexArrayObject;\n    const attrib = vao.attribs[index];\n    switch (pname) {\n      case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n        return attrib.buffer;\n      case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n        return attrib.enabled;\n      case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n        return attrib.size;\n      case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n        return attrib.stride;\n      case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n        return attrib.type;\n      case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n        return attrib.normalized;\n      default:\n        return original.getVertexAttrib.apply(this, arguments);\n    }\n  };\n\n  gl.vertexAttribPointer = function vertexAttribPointer(\n    indx,\n    size,\n    type,\n    normalized,\n    stride,\n    offset\n  ) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n    const attrib = vao.attribs[indx];\n    attrib.buffer = self.currentArrayBuffer;\n    attrib.size = size;\n    attrib.type = type;\n    attrib.normalized = normalized;\n    attrib.stride = stride;\n    attrib.offset = offset;\n    attrib.recache();\n    return original.vertexAttribPointer.apply(this, arguments);\n  };\n\n  if (gl.instrumentExtension) {\n    gl.instrumentExtension(this, 'OES_vertex_array_object');\n  }\n\n  // undefined for headless gl\n  if (gl.canvas) {\n    gl.canvas.addEventListener(\n      'webglcontextrestored',\n      () => {\n        log('OESVertexArrayObject emulation library context restored');\n        self.reset_();\n      },\n      true\n    );\n  }\n\n  this.reset_();\n};\n\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85b5;\n\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n  const contextWasLost = this.vertexArrayObjects !== undefined;\n  if (contextWasLost) {\n    for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n      this.vertexArrayObjects.isAlive = false;\n    }\n  }\n  const gl = this.gl;\n  this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n  this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n  this.currentVertexArrayObject = null;\n  this.currentArrayBuffer = null;\n  this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n  this.bindVertexArrayOES(null);\n};\n\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n  const arrayObject = new WebGLVertexArrayObjectOES(this);\n  this.vertexArrayObjects.push(arrayObject);\n  return arrayObject;\n};\n\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n  arrayObject.isAlive = false;\n  this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n  if (this.currentVertexArrayObject === arrayObject) {\n    this.bindVertexArrayOES(null);\n  }\n};\n\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n  if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n    if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n      return true;\n    }\n  }\n  return false;\n};\n\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n  const gl = this.gl;\n  if (arrayObject && !arrayObject.isAlive) {\n    synthesizeGLError(\n      gl.INVALID_OPERATION,\n      'bindVertexArrayOES: attempt to bind deleted arrayObject'\n    );\n    return;\n  }\n  const original = this.original;\n\n  const oldVAO = this.currentVertexArrayObject;\n  this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n  this.currentVertexArrayObject.hasBeenBound = true;\n  const newVAO = this.currentVertexArrayObject;\n\n  if (oldVAO === newVAO) {\n    return;\n  }\n\n  if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n    original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n  }\n\n  let currentBinding = this.currentArrayBuffer;\n  const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n  for (let n = 0; n <= maxAttrib; n++) {\n    const attrib = newVAO.attribs[n];\n    const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n    if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n      if (attrib.enabled) {\n        original.enableVertexAttribArray.call(gl, n);\n      } else {\n        original.disableVertexAttribArray.call(gl, n);\n      }\n    }\n\n    if (attrib.enabled) {\n      let bufferChanged = false;\n      if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n        if (currentBinding !== attrib.buffer) {\n          original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n          currentBinding = attrib.buffer;\n        }\n        bufferChanged = true;\n      }\n\n      if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n        original.vertexAttribPointer.call(\n          gl,\n          n,\n          attrib.size,\n          attrib.type,\n          attrib.normalized,\n          attrib.stride,\n          attrib.offset\n        );\n      }\n    }\n  }\n\n  if (this.currentArrayBuffer !== currentBinding) {\n    original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n  }\n};\n\nexport function polyfillVertexArrayObject(gl) {\n  if (typeof gl.createVertexArray === 'function') {\n    // VAOs directly supported on object (i.e. WebGL 2 context)\n    return;\n  }\n\n  const original_getSupportedExtensions = gl.getSupportedExtensions;\n  gl.getSupportedExtensions = function getSupportedExtensions() {\n    const list = original_getSupportedExtensions.call(this) || [];\n    if (list.indexOf('OES_vertex_array_object') < 0) {\n      list.push('OES_vertex_array_object');\n    }\n    return list;\n  };\n\n  const original_getExtension = gl.getExtension;\n  gl.getExtension = function getExtension(name) {\n    const ext = original_getExtension.call(this, name);\n    if (ext) {\n      return ext;\n    }\n    if (name !== 'OES_vertex_array_object') {\n      return null;\n    }\n\n    if (!gl.__OESVertexArrayObject) {\n      this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n    }\n    return this.__OESVertexArrayObject;\n  };\n}\n"]},"metadata":{},"sourceType":"module"}